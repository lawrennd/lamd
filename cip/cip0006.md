---
author: lawrennd
created: '2025-07-02'
id: '0006'
last_updated: '2026-01-04'
status: Accepted
related_requirements: ["0003"]
tags:
- cip
- cli
- interface
- workflow
title: Two-Stage Command Line Interface for lamd Utilities
---

# CIP-0006: Two-Stage Command Line Interface for lamd Utilities

## Summary

This CIP proposes to refactor the command line utilities in the lamd project to use a two-stage process. The first stage generates a standardized interface file describing the inputs, outputs, and computations. The second stage executes the command using this interface file, enabling better workflow management, reproducibility, and integration with publish/subscribe services.

**Status Update (2026-01-04)**: Accepted with phased implementation approach. Starting with `maketalk`/`makecv` as pilots before expanding to other utilities.

## Motivation

Currently, lamd command line utilities operate as single-stage commands, which can make it difficult to:
- Track and document the full workflow
- Integrate with external workflow managers or publish/subscribe systems
- Reproduce or audit computations
- Separate configuration from execution

A two-stage approach, inspired by the interface pattern in [referia](https://github.com/lawrennd/referia/blob/main/referia/config/interface.py), would improve transparency, modularity, and automation.

## Detailed Description

The proposed two-stage process is as follows:

1. *Stage 1: Interface File Generation*
   - The CLI utility generates an interface file (YAML or similar) with the following structure:
     ```
     input:
       # Specify the input files here
     output:
       # Specify the output files here
     compute:
       # Specify the computations that are done on the two
     ```
   - This file documents the workflow and can be registered with a publish/subscribe service.

2. *Stage 2: Execution*
   - The CLI utility (or a runner) reads the interface file and executes the specified computation.
   - This enables decoupling of configuration and execution, and allows for workflow orchestration.

## Implementation Plan

### Phased Approach (Accepted 2026-01-04)

**Phase 1: Pilot with maketalk/makecv** (Recommended starting point)
1. Design the interface file schema (YAML format)
   - Leverage existing `Interface` class from `lamd.config.interface`
   - Extend to include `compute` section describing transformations
2. Add `--generate-interface` flag to `maketalk` and `makecv`
   - Generate interface file without executing build
   - Include inputs (markdown file, config, snippets, diagrams)
   - Include outputs (HTML, PDF, DOCX, etc.)
   - Document compute steps (Makefile operations)
3. Add `--from-interface` flag to execute from interface file
   - Read interface file
   - Validate inputs exist
   - Execute build as specified
4. Gather user feedback
   - Does this improve workflow transparency?
   - Is the interface file useful for integration?
   - What additional information would be helpful?

**Phase 2: Expand based on feedback** (Future)
- Extend to other CLI utilities if Phase 1 proves valuable
- Add publish/subscribe integration if there's demand
- Consider workflow orchestration features

**Phase 3: Advanced features** (Optional, based on Phase 2 results)
- Integration with external workflow managers
- Workflow visualization tools
- Automated dependency tracking

## Backward Compatibility

- The existing single-stage CLI behavior should be preserved as a default.
- The two-stage workflow should be opt-in via a flag or subcommand.

## Implementation Status

- [ ] Phase 1: Design interface schema (extend lamd.config.interface.Interface)
- [ ] Phase 1: Implement --generate-interface flag in maketalk
- [ ] Phase 1: Implement --generate-interface flag in makecv
- [ ] Phase 1: Implement --from-interface flag in maketalk
- [ ] Phase 1: Implement --from-interface flag in makecv
- [ ] Phase 1: Gather user feedback
- [ ] Phase 2: Decision point - expand or refine?
- [ ] Phase 3: Advanced features (conditional on Phase 2 success)

## Testing Strategy

**Phase 1 Testing:**
- Unit tests for interface file generation and parsing
- Integration tests for two-stage workflows with maketalk/makecv
- Backward compatibility tests (ensure existing usage still works)
- Performance tests (ensure interface generation doesn't add significant overhead)

**Phase 2+ Testing:**
- Additional integration tests as features expand
- Tests for publish/subscribe registration (if implemented)
- Cross-utility workflow tests

## Related Work

- [GitHub Issue #1](https://github.com/lawrennd/lamd/issues/1) (original proposal)
- [referia interface.py](https://github.com/lawrennd/referia/blob/main/referia/config/interface.py)

## Author
lawrennd

## Date
2025-07-02